<template>
  <div class="page" id="home" data-name="home">
    <!-- Top Navbar -->
    <div class="page-content">
      <section id="irju">
        <div id="i5c3" class="container">
          <h1 id="im2ty" class="header__title">Carl &amp; The Plague
          </h1>
          <div class="block">
            <div id="ikesp" class="header__subtitle">Estar en casa no tendría porque ser aburrido, diviértete con Carl y evita q tu ciudad colapse. #staysafe
            </div>
          </div>
          <img id="i2ljjm" src="static/carl-logo.png" class="carl-logo"/>
          <div class="block">
            <div class="gpd-text carl-resumen" id="i4uekg">Una pandemia nos ha atacado en Carl &amp; The Plague, tu misión para este videojuego será salvarnos ¿estás listo?
            </div>
          </div>
          <!-- <div id="i3btze">
          </div> -->
          <a href="" class="" id="comprar"><img alt="buy.png" src="static/compra.png" class="apple-download" id="inzjg3"/></a>
          <div class="block">
            <div class="carl-resumen">Disponible en:</div>
          </div>
          <img alt="google.png" src="static/disponible.png" id="i9subb" class="google-download"/>
          <div id="i29sx2">
          </div>
        </div>
        <div id="itdhl" class="container">
          <img alt="Carl1024x500(2).jpg" src="static/screen.jpg" class="screen-img" id="iz3scc"/>
          <div id="ineqkd">
          </div>
          <div class="block">
            <div class="gpd-text descripcion-carl" id="i3wq11">
              <div style="text-align: justify;">En tiempos de cuarentena, We The Force® estudio desarrollador de productos interactivos desarrolló un videojuego en donde el personaje principal “Carl” deberá controlar una ciudad que será atacada por una pandemia.
                <br>&nbsp;
                <br>Simularemos la situación actual dentro del juego, cada movimiento que realices se verá reflejado en la economía, así como en el crecimiento o reducción de infectados, y en el caos o recuperación de la ciudad. Tu misión: ayudar a Carl a salvarnos de esta pandemia.
                <br>​​​​​​​
                <br>Ayúdalo y apóyanos, lo recaudado será donado a los adultos mayores que se quedaron sin trabajo a causa de esta situación.
              </div>
            </div>
          </div>
        </div>
      </section>
      <section id="izt1k">
        
      </section>
      <footer class="footer" id="ixlqex">
        <div class="container">
          <div data-columns="1" class="row" id="ij8mak">
            <div data-column="1" id="il1wwf" class="cell">
              <img id="izgzj" src="static/wtf.png"/>
              <h2 class="section__title" id="ikpeal">Síguenos
              </h2>
              <div class="footer-socials" id="i9o5hw">
                <a href="##" target="_blank" class="footer-link-svg" id="ilafpg"><svg viewBox="0 0 430.1 430.1" width="100%" height="100%" id="idyf0v">
                  <path d="M158.1 83.3c0 10.8 0 59.2 0 59.2h-43.4v72.4h43.4v215.2h89.1V214.9h59.8c0 0 5.6-34.7 8.3-72.7 -7.8 0-67.8 0-67.8 0s0-42.1 0-49.5c0-7.4 9.7-17.4 19.3-17.4 9.6 0 29.8 0 48.6 0 0-9.9 0-43.9 0-75.4 -25 0-53.5 0-66 0C155.9 0 158.1 72.5 158.1 83.3z">
                  </path>
                  </svg></a>
                <a href="##" target="_blank" class="footer-link-svg" id="iq6b1f"><svg viewBox="0 0 32 28" width="100%" height="100%" id="icuse9">
                  <path d="M32 4.8c-1.2.5-2.4.8-3.8 1 1.4-.7 2.4-1.9 2.9-3.4-1.3.7-2.7 1.2-4.2 1.5-1.2-1.2-2.9-1.9-4.7-1.9-3.6 0-6.6 2.7-6.6 6.1 0 .5.1.9.2 1.4-5.5-.3-10.3-2.7-13.6-6.4-.5.9-.9 1.9-.9 3.1 0 2.1 1.2 4 2.9 5-1.1 0-2.1-.3-3-.8v.1c0 2.9 2.3 5.4 5.3 5.9-.6.1-1.1.2-1.7.2-.4 0-.8 0-1.2-.1.8 2.4 3.3 4.2 6.1 4.2-2.2 1.6-5.1 2.6-8.2 2.6-.5 0-1.1 0-1.6-.1 3 1.8 6.5 2.8 10.2 2.8 12.1 0 18.7-9.2 18.7-17.2v-.8c1.2-.9 2.3-1.9 3.2-3.2z">
                  </path>
                  </svg></a>
                <a href="##" target="_blank" class="footer-link-svg" id="ikhlsg">
                  <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" id="icuse999"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                </a>
              </div>
            </div>
          </div>
          <div class="block">
            <div class="footer-copyright" id="iv3c2e">© We The Force. All Rights Reserved
            </div>
          </div>
        </div>
      </footer>
    </div>
    <div class="popup popup-info">
      <div class="block t-right">
        <a class="link popup-close" href="#"><i class="f7-icons" >multiply_circle_fill</i></a>
      </div>
      <div class="block-title block-title-large  block-80">Gracias!</div>
      <div class="block block-80">
        <p>Ayúdanos con tu información para generar tu link de pago.</p>
      </div>
      <form class="list" id="comprar-form">
        <ul>
          <li>
            <div class="item-content item-input">
              <div class="item-inner">
                <div class="item-title item-floating-label">Nombre</div>
                <div class="item-input-wrap">
                  <input type="text" name="name" placeholder="Tu nombre" required validate>
                </div>
              </div>
            </div>
          </li>
          <li>
            <div class="item-content item-input">
              <div class="item-inner">
                <div class="item-title item-floating-label">E-mail</div>
                <div class="item-input-wrap">
                  <input type="email" name="email" placeholder="E-mail" required validate>
                </div>
              </div>
            </div>
          </li>
          <li>
            <div class="item-content item-input">
              <div class="item-inner">
                <div class="item-title item-floating-label">Celular</div>
                <div class="item-input-wrap">
                  <input type="tel" name="cel" placeholder="Celular" required validate pattern="[0-9]*" data-error-message="Sólo números por favor!">
                </div>
              </div>
            </div>
          </li>
          
        </ul>
      </form>
      <div class="block  buttons-comprar row">
        <div class="col"><a class="button popup-close" href="#">Cancelar</a></div>
        <div class="col"><a class="button button-fill button-round fill-form-from-data" id="pagar" href="#">Pagar</a></div>
      </div>
    </div>
  </div>
</template>
<script>
  import $$ from 'dom7';
  import {loadStripe} from '@stripe/stripe-js';

export default {
  on: {
    pageMounted: function(e, page) {
      var self = this;
      var app = self.$app;
      var stripe = Stripe(app.data.stripePK);
      app.request.setup({
        headers: {
          'Authorization': 'Bearer '+app.data.stripeSK,
          'Content-Type': 'application/x-www-form-urlencoded'
        }
      });

      var stripeurl = app.data.stripeUrl;
      console.log(page.route.context);
      console.log('intento 1.24');

      function validateEmail(email) {
        const re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
      }
      var popupInfo = app.popup.create({
        el: '.popup-info',
        on: {
          open: function(popup){
            $$('#pagar').on('click', function(e){
              e.preventDefault();
            var formData = app.form.convertToData('#comprar-form');
            var emailValue = validateEmail(formData.email);
            var nameValue = formData.name;
            console.log(emailValue);
            // formData = JSON.stringify(formData);
            if(formData.name=='' || formData.email=='' || !validateEmail(formData.email) || formData.cel==''){
              app.dialog.alert('Datos incompletos! :(', 'Ooops! v6');
            } else {
             
              //AQUÍ PONEMOS LA FUNCIÓN DE COBRO
      
            }
            });

          }
        }
      });
      $$('#comprar').on('click', function(ev){
        ev.preventDefault();
//        popupInfo.open();

        app.request.promise.post(stripeurl, 
        {
          success_url: 'https://carlpayment.netlify.app/#!/payment/{CHECKOUT_SESSION_ID}',
          cancel_url: 'https://carlpayment.netlify.app/#!/payment/',                
          payment_method_types: ['card'],
          line_items: [{
            price_data: {
              currency: 'mxn',
              product_data: {
                name: 'CARL AND THE PLAGUE',
              },
              unit_amount: 5000,
            },
            quantity: 1,
          }],
          mode: 'payment',
        }
        ).then(function(res){
          var sessionData = JSON.parse(res.data);
          console.log(sessionData.id);
          stripe.redirectToCheckout({
        
            sessionId: sessionData.id
          })
        })        
      })
    }
  }
}


</script>